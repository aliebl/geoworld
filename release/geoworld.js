function assert(t,i){if(!t)throw void 0===i?"Assertation Failed!":"Assertation Failed! "+i}!function(){for(var t=0,i=["ms","moz","webkit","o"],e=0;e<i.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[i[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[i[e]+"CancelAnimationFrame"]||window[i[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(i){var e=(new Date).getTime(),s=Math.max(0,16-(e-t)),h=window.setTimeout(function(){i(e+s)},s);return t=e+s,h}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}(),Math.clamp=function(t,i,e){var s=i>t?i:t;return s>e?e:s},Math.EPSILON=5e-324,Math.almostEqual=function(t,i){return Math.abs(t-i)<Math.EPSILON},Math.lerp=function(t,i,e){return t+(i-t)*e},Vector=function(t,i){this.x=void 0===t?0:t,this.y=void 0===i?0:i},Vector.prototype.scale=function(t){return new Vector(this.x*t,this.y*t)},Vector.prototype.plusEquals=function(t){return this.x+=t.x,this.y+=t.y,this},Vector.prototype.plus=function(t){return new Vector(this.x,this.y).plusEquals(t)},DynamicPhysicsObject=function(t,i){this.position=t,this.velocity=i,this.maxVelocity=void 0,this.frictionConstant=0,this.lastAcceleration=new Vector(0,0),this.gravityScale=1,this.hangTimeEnabled=!1,this.hangTimeVelocityThreshold=0,this.hangTimeMinimum=1,void 0===this.position&&(this.position=new Vector(0,0)),void 0===this.velocity&&(this.velocity=new Vector(0,0))},DynamicPhysicsObject.prototype.update=function(t){var i=t/1e3;assert(!isNaN(this.velocity.x)),assert(!isNaN(this.velocity.y)),void 0!==this.maxVelocity&&(this.velocity.x=Math.clamp(this.velocity.x,-this.maxVelocity.x,this.maxVelocity.x),this.velocity.y=Math.clamp(this.velocity.y,-this.maxVelocity.y,this.maxVelocity.y)),!this.isOnGround()||this.lastAcceleration.x<0&&this.velocity.x<0||this.lastAcceleration.x>0&&this.velocity.x>0||(this.velocity.x<Math.EPSILON?(this.velocity.x+=this.frictionConstant*i,this.velocity.x>=0&&(this.velocity.x=0)):this.velocity.x>-Math.EPSILON?(this.velocity.x-=this.frictionConstant*i,this.velocity.x<=0&&(this.velocity.x=0)):this.velocity.x=0),this.isOnGround()||(gravity=Game.physics.gravityConstant*this.gravityScale,this.hangTimeEnabled&&Math.abs(this.velocity.y)<this.hangTimeVelocityThreshold&&this.velocity.y<0&&(gravity=Math.lerp(gravity,gravity*this.hangTimeMinimum,1-this.velocity.y/-this.hangTimeVelocityThreshold)),this.velocity.y+=gravity*i),this.position.plusEquals(this.velocity.scale(i)),this.isOnGround()&&(this.velocity.y=0),this.lastAcceleration=new Vector(0,0)},DynamicPhysicsObject.prototype.accelerate=function(t,i){void 0===i&&(i=1),this.velocity.x+=t.x*i,this.velocity.y+=t.y*i,this.lastAcceleration.plusEquals(t.scale(i))},DynamicPhysicsObject.prototype.isOnGround=function(){return this.position.y>=Game.gameHeight},Player=function(){this.spritesheet=new Image,this.spritesheet.src="robot.png",this.spriteWidth=80,this.spriteHeight=100,this.spriteHalfWidth=this.spriteWidth/2,this.spriteHalfHeight=this.spriteHeight/2,this.facingLeft=!1,this.instantaneousJumpImpulse=-200,this.acceleration=200,this.physics=new DynamicPhysicsObject(new Vector(300,100)),this.physics.maxVelocity=new Vector(200,400),this.physics.frictionConstant=200,this.physics.hangTimeEnabled=!1,this.physics.hangTimeVelocityThreshold=30,this.physics.hangTimeMinimum=.1,this.jumpsLeft=1,this.frame={x:0,y:0,width:80,height:100}},Player.prototype.update=function(t,i){var e=t/1e3;this.physics.hangTimeEnabled=Game.enableHangTime(),this.physics.gravityScale=this.isUnderWater()?.5:1,i.left&&(this.physics.accelerate(new Vector(-this.acceleration,0),e),this.facingLeft=!0),i.right&&(this.physics.accelerate(new Vector(this.acceleration,0),e),this.facingLeft=!1),i.up&&(this.physics.isOnGround()||this.jumpsLeft>0||this.isUnderWater())&&(console.log("JUMP!"),this.physics.isOnGround()?this.jumpsLeft=Game.enableDoubleJump()?1:0:this.jumpsLeft--,i.up=!1,this.physics.accelerate(new Vector(0,this.instantaneousJumpImpulse*this.physics.gravityScale))),this.physics.update(t),this.physics.position.x>Game.gameWidth+this.spriteWidth/2&&(this.physics.position.x=-this.spriteWidth/2),this.physics.position.x<-this.spriteWidth/2&&(this.physics.position.x=Game.gameWidth+this.spriteWidth/2),this.frame={x:0,y:0,width:this.spriteWidth,height:this.spriteHeight},this.physics.isOnGround()?this.physics.velocity<-Math.EPSILON?(this.frame.y=this.spriteHeight,this.frame.x=this.physics.velocity.x>-.5?this.spriteWidth:this.physics.velocity.x>-.5?2*this.spriteWidth:this.physics.velocity.x>-8?3*this.spriteWidth:4*this.spriteWidth):this.physics.velocity>Math.EPSILON&&(this.frame.y=this.spriteHeight,this.frame.x=this.physics.velocity.x<.5?this.spriteWidth:this.physics.velocity.x<.5?2*this.spriteWidth:this.physics.velocity.x<8?3*this.spriteWidth:4*this.spriteWidth):(this.frame.x=Math.abs(this.physics.velocity.y)<.5?this.spriteWidth:Math.abs(this.physics.velocity.y)<8?2*this.spriteWidth:Math.abs(this.physics.velocity.y)<50?3*this.spriteWidth:4*this.spriteWidth,this.frame.y=this.physics.velocity.y<0?2*this.spriteHeight:3*this.spriteHeight)},Player.prototype.isUnderWater=function(){return Game.enableWaterOnLeft()&&this.physics.position.x<=Game.gameWidth/2?!0:Game.enableWaterOnRight()&&this.physics.position.x>Game.gameWidth/2?!0:!1},Player.prototype.render=function(t,i){i.save(),i.translate(this.physics.position.x,this.physics.position.y),this.facingLeft&&i.scale(-1,1),i.drawImage(this.spritesheet,this.frame.x,this.frame.y,this.frame.width,this.frame.height,-this.spriteHalfWidth,-this.spriteHeight,this.spriteWidth,this.spriteHeight),i.restore()},Geoworld=function(){function t(t){c.update(t,o)}function i(t){n.clearRect(0,0,Game.gameWidth,Game.gameHeight),c.render(t,n),(Game.enableWaterOnLeft()||Game.enableWaterOnRight())&&(n.save(),n.fillStyle="rgba(52, 179, 247, 0.5)",Game.enableWaterOnLeft()&&n.fillRect(0,0,Game.gameWidth/2,Game.gameHeight),Game.enableWaterOnRight()&&n.fillRect(Game.gameWidth/2,0,Game.gameWidth/2,Game.gameHeight),n.restore())}function e(h){var a=h-s;s=h,t(a),i(a),window.requestAnimationFrame(e)}var s=0,h=document.getElementById("geoworld"),a=document.getElementById("gameplay-canvas");this.gameWidth=a.clientWidth,this.gameHeight=a.clientHeight;var n=a.getContext("2d"),o={left:!1,up:!1,right:!1,down:!1},c=new Player(h);this.physics=new Object,this.physics.gravityConstant=100,document.addEventListener("keydown",function(t){var i=t.keyCode||t.which;switch(i){case 37:o.left=!0;break;case 38:o.up=!0;break;case 39:o.right=!0;break;case 40:o.down=!0}}),document.addEventListener("keyup",function(t){var i=t.keyCode||t.which;switch(i){case 37:o.left=!1;break;case 38:o.up=!1;break;case 39:o.right=!1;break;case 40:o.down=!1}}),this.startGame=function(){e(0)},this.setDebugString=function(t){document.getElementById("debug").innerHTML=t},this.enableHangTime=function(){return document.getElementById("hangTime").checked},this.enableWaterOnLeft=function(){return document.getElementById("waterOnLeft").checked},this.enableWaterOnRight=function(){return document.getElementById("waterOnRight").checked},this.enableDoubleJump=function(){return document.getElementById("doubleJump").checked}},Game=new Geoworld,Game.startGame();